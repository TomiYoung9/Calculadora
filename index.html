<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Funci√≥n Diast√≥lica ASE 2025</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: linear-gradient(135deg, #2c3e50, #3498db); color: white; padding: 30px 20px 20px 20px; text-align: center; position: relative; }
        .header h1 { font-size: 2.2em; margin-bottom: 10px; }
        .form-container { padding: 40px; }
        .parameter-group { margin-bottom: 25px; padding: 20px; border: 2px solid #ecf0f1; border-radius: 10px; transition: all 0.3s ease; }
        .parameter-group:hover { border-color: #3498db; box-shadow: 0 5px 15px rgba(52, 152, 219, 0.1); }
        .parameter-group h3 { color: #2c3e50; margin-bottom: 15px; font-size: 1.3em; border-bottom: 2px solid #3498db; padding-bottom: 5px; }
        .input-row { display: flex; align-items: center; margin-bottom: 15px; flex-wrap: wrap; }
        .input-row label { flex: 1; min-width: 200px; font-weight: 600; color: #34495e; margin-right: 15px; }
        .input-row input, .input-row select { flex: 0 0 120px; padding: 10px; border: 2px solid #bdc3c7; border-radius: 5px; font-size: 16px; transition: border-color 0.3s ease; }
        .input-row input:focus, .input-row select:focus { outline: none; border-color: #3498db; }
        .unit { margin-left: 10px; color: #7f8c8d; font-weight: 500; }
        .optional { background: #f8f9fa; border-left: 4px solid #17a2b8; }
        .optional h3 { color: #17a2b8; border-bottom-color: #17a2b8; }
        .calculate-btn { width: 100%; padding: 15px; background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; border: none; border-radius: 10px; font-size: 1.2em; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-top: 20px; }
        .calculate-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(46, 204, 113, 0.3); }
        .results { margin-top: 30px; padding: 25px; border-radius: 10px; display: none; }
        .results.normal { background: linear-gradient(135deg, #2ecc71, #27ae60); color: white; }
        .results.abnormal { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; }
        .results.indeterminate { background: linear-gradient(135deg, #f39c12, #e67e22); color: white; }
        .results h3 { font-size: 1.5em; margin-bottom: 15px; }
        .parameter-status { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-top: 20px; }
        .parameter-item { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; border-left: 4px solid rgba(255,255,255,0.5); }
        .parameter-item.abnormal { border-left-color: #fff; background: rgba(255,255,255,0.2); }
        .recommendations { margin-top: 20px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 8px; }
        .info-box { background: #ecf0f1; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 5px solid #3498db; }
        .info-box h4 { color: #2c3e50; margin-bottom: 10px; }
        .info-box p { color: #34495e; line-height: 1.6; }
        .age-reference { background: #e8f4fd; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #3498db; }
        .fa-warning { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 8px; margin-top: 15px; color: #856404; }
        .fevi-warning { background: #fff8e1; border: 1px solid #ffecb3; padding: 15px; border-radius: 8px; margin-top: 15px; color: #6d4c41; }
        .referencias { margin-top: 40px; padding: 25px; background: #f8f9fa; border-radius: 10px; border-left: 5px solid #17a2b8; }
        .referencias h3 { color: #17a2b8; margin-bottom: 20px; font-size: 1.3em; }
        .referencia-item { margin-bottom: 15px; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .referencia-item p { margin: 0; line-height: 1.6; color: #2c3e50; }
        .referencia-item a { color: #3498db; text-decoration: none; font-weight: 500; }
        .referencia-item a:hover { color: #2980b9; text-decoration: underline; }
        .footer { background: #f4f7fa; text-align: center; padding: 25px 10px 15px 10px; border-top: 2px solid #e1e5e9; margin-top: 40px; color: #7f8c8d; }
        .twitter-section { text-align: center; padding: 15px; margin-bottom: 10px; }
        .twitter-link { display: inline-flex; align-items: center; gap: 8px; color: #111; text-decoration: none; font-weight: 600; font-size: 1.1em; transition: all 0.3s ease; }
        .twitter-link:hover { color: #0d8bd9; transform: translateY(-1px); }
        .twitter-icon { width: 24px; height: 24px; }
        .ai-option-note { font-size: 0.9em; color: #666; margin-top: 10px; font-style: italic; }
        .pressure-status { font-size: 1.3em; font-weight: bold; margin-top: 15px; padding: 10px; border-radius: 8px; text-align: center; }
        .pressure-status.normal { background: rgba(255,255,255,0.2); color: white; }
        .pressure-status.elevated { background: rgba(255,255,255,0.3); color: white; }
        @media (max-width: 768px) { .input-row { flex-direction: column; align-items: stretch; } .input-row label { margin-bottom: 5px; margin-right: 0; } .input-row input, .input-row select { flex: 1; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü´Ä Calculadora Funci√≥n Diast√≥lica ASE 2025</h1>
        </div>
        <div class="form-container">
            <div class="info-box">
                <h4>üìã Instrucciones</h4>
                <p>Complete los par√°metros ecocardiogr√°ficos. Los valores de velocidad deben estar en cm/s para E, A, e' y en <b>m/s</b> para la velocidad de regurgitaci√≥n tricusp√≠dea (TR). El strain auricular y la FEVI son opcionales.</p>
            </div>
            <form id="diastolicForm">
                <div class="parameter-group">
                    <h3>ü©∫ Contexto Cl√≠nico</h3>
                    <div class="input-row">
                        <label>Ritmo card√≠aco:</label>
                        <select id="ritmo" onchange="toggleEASection()">
                            <option value="sinusal">Ritmo sinusal</option>
                            <option value="fa">Fibrilaci√≥n auricular</option>
                        </select>
                    </div>
                    <div class="input-row">
                        <label>Edad del paciente:</label>
                        <input type="number" id="edad" min="18" max="120" onchange="updateAgeReferences()">
                        <span class="unit">a√±os</span>
                    </div>
                    <div class="input-row optional">
                        <label>FEVI (Fracci√≥n de eyecci√≥n del VI):</label>
                        <input type="number" id="fevi" step="1" min="10" max="90" placeholder="Opcional">
                        <span class="unit">%</span>
                    </div>
                </div>
                <div id="ageReferences" class="age-reference" style="display:none;">
                    <h4>üìä Valores de referencia para esta edad:</h4>
                    <div id="ageReferenceContent"></div>
                </div>
                <div class="parameter-group" id="eaSection">
                    <h3>üîÑ Flujo Mitral (Doppler Pulsado)</h3>
                    <div class="input-row">
                        <label>Velocidad de onda E:</label>
                        <input type="number" id="velocidadE" step="0.1" min="0" max="300">
                        <span class="unit">cm/s</span>
                    </div>
                    <div class="input-row">
                        <label>Velocidad de onda A:</label>
                        <input type="number" id="velocidadA" step="0.1" min="0" max="300">
                        <span class="unit">cm/s</span>
                    </div>
                </div>
                <div id="faWarning" class="fa-warning" style="display:none;">
                   ‚ö†Ô∏è <strong>Fibrilaci√≥n Auricular:</strong> La relaci√≥n E/A no se evaluar√° debido a la ausencia de onda A.
                </div>
                <div class="parameter-group">
                    <h3>üéØ Doppler Tisular</h3>
                    <div class="input-row">
                        <label>e' septal:</label>
                        <input type="number" id="eSeptal" step="0.1" min="0" max="30">
                        <span class="unit">cm/s</span>
                    </div>
                    <div class="input-row">
                        <label>e' lateral:</label>
                        <input type="number" id="eLateral" step="0.1" min="0" max="30">
                        <span class="unit">cm/s</span>
                    </div>
                </div>
                <div class="parameter-group">
                    <h3>üìè Aur√≠cula Izquierda</h3>
                    <div class="input-row">
                        <label>Tipo de medici√≥n:</label>
                        <select id="tipoAI" onchange="toggleAIInput()">
                            <option value="volumen">Volumen indexado</option>
                            <option value="area">√Årea</option>
                        </select>
                    </div>
                    <div class="input-row" id="volumenRow">
                        <label>Volumen auricular izquierdo indexado:</label>
                        <input type="number" id="volumenAI" step="1" min="0" max="200">
                        <span class="unit">ml/m¬≤</span>
                    </div>
                    <div class="input-row" id="areaRow" style="display:none;">
                        <label>√Årea auricular izquierda:</label>
                        <input type="number" id="areaAI" step="0.1" min="0" max="50">
                        <span class="unit">cm¬≤</span>
                    </div>
                    <div class="ai-option-note">
                        <em>Complete uno u otro par√°metro. Valores de referencia: Volumen ‚â§34 ml/m¬≤ o √Årea ‚â§20 cm¬≤</em>
                    </div>
                </div>
                <div class="parameter-group">
                    <h3>üåä Regurgitaci√≥n Tricusp√≠dea</h3>
                    <div class="input-row">
                        <label>Velocidad pico de regurgitaci√≥n tricusp√≠dea:</label>
                        <input type="number" id="velocidadRT" step="0.01" min="0" max="6">
                        <span class="unit">m/s</span>
                    </div>
                </div>
                <div class="parameter-group optional">
                    <h3>‚≠ê Strain Auricular Izquierdo (Opcional - ASE 2025)</h3>
                    <div class="input-row">
                        <label>LA Strain (strain auricular izquierdo):</label>
                        <input type="number" id="laStrain" step="1" min="0" max="60" placeholder="Opcional">
                        <span class="unit">%</span>
                    </div>
                    <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
                        <em>Si no est√° disponible, el algoritmo funcionar√° con los otros par√°metros.</em>
                    </p>
                </div>
                <button type="button" class="calculate-btn" onclick="calcularFuncionDiastolica()">
                    üßÆ Calcular Funci√≥n Diast√≥lica
                </button>
            </form>
            <div id="results" class="results">
                <div id="feviWarning" class="fevi-warning" style="display:none;">
                    ‚ö†Ô∏è <strong>FEVI Reducida:</strong> En pacientes con FEVI &lt;50%, se asume disfunci√≥n diast√≥lica. Lo relevante es estimar la presi√≥n de llenado.
                </div>
                <h3 id="diagnostico"></h3>
                <div id="pressureStatus" class="pressure-status"></div>
                <div id="parametros-status" class="parameter-status"></div>
                <div id="recomendaciones" class="recommendations"></div>
            </div>
            
            <div class="referencias">
                <h3>üìö Referencias Bibliogr√°ficas</h3>
                <div class="referencia-item">
                    <p><strong>Nagueh SF, Smiseth OA, Appleton CP, et al.</strong> Recommendations for the Evaluation of Left Ventricular Diastolic Function by Echocardiography: An Update from the American Society of Echocardiography and the European Association of Cardiovascular Imaging. <em>J Am Soc Echocardiogr.</em> 2016;29(4):277-314. 
                    <a href="https://doi.org/10.1016/j.echo.2016.01.011" target="_blank" rel="noopener">doi:10.1016/j.echo.2016.01.011</a></p>
                </div>
                <div class="referencia-item">
                    <p><strong>American Society of Echocardiography.</strong> Guidelines for the Evaluation of Diastolic Function. Updated recommendations based on current evidence. 
                    <a href="https://www.asecho.org/" target="_blank" rel="noopener">Disponible en: www.asecho.org</a></p>
                </div>
            </div>
        </div>
        <div class="twitter-section">
            <a href="https://x.com/atomasyoung" target="_blank" rel="noopener" class="twitter-link">
                <svg class="twitter-icon" viewBox="0 0 1200 1227" fill="currentColor">
                    <path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z"/>
                </svg>
                @atomasyoung
            </a>
        </div>
        <div class="footer">
            <p>Calculadora basada en las gu√≠as ASE para evaluaci√≥n de funci√≥n diast√≥lica</p>
        </div>
    </div>
    <script>
        function toggleEASection() {
            const ritmo = document.getElementById('ritmo').value;
            const eaSection = document.getElementById('eaSection');
            const faWarning = document.getElementById('faWarning');
            if (ritmo === 'fa') {
                eaSection.style.display = 'none';
                faWarning.style.display = 'block';
                document.getElementById('velocidadE').value = '';
                document.getElementById('velocidadA').value = '';
            } else {
                eaSection.style.display = 'block';
                faWarning.style.display = 'none';
            }
        }

        function toggleAIInput() {
            const tipoAI = document.getElementById('tipoAI').value;
            const volumenRow = document.getElementById('volumenRow');
            const areaRow = document.getElementById('areaRow');
            if (tipoAI === 'volumen') {
                volumenRow.style.display = 'flex';
                areaRow.style.display = 'none';
                document.getElementById('areaAI').value = '';
            } else {
                volumenRow.style.display = 'none';
                areaRow.style.display = 'flex';
                document.getElementById('volumenAI').value = '';
            }
        }

        function updateAgeReferences() {
            const edad = parseInt(document.getElementById('edad').value);
            const ageReferences = document.getElementById('ageReferences');
            const ageReferenceContent = document.getElementById('ageReferenceContent');
            if (edad >= 18) {
                let eRef, eaRef;
                if (edad < 50) {
                    eRef = "e' promedio ‚â• 10 cm/s";
                    eaRef = 'E/A ‚â• 1.0';
                } else if (edad < 65) {
                    eRef = "e' promedio ‚â• 8 cm/s";
                    eaRef = 'E/A: 0.8-2.0';
                } else {
                    eRef = "e' promedio ‚â• 6 cm/s";
                    eaRef = 'E/A: 0.7-2.0';
                }
                ageReferenceContent.innerHTML = `
                    <strong>Edad ${edad} a√±os:</strong><br>
                    ‚Ä¢ ${eRef}<br>
                    ‚Ä¢ ${eaRef}<br>
                    ‚Ä¢ E/e' ‚â§ 14<br>
                    ‚Ä¢ LAVI ‚â§ 34 ml/m¬≤ o √Årea AI ‚â§ 20 cm¬≤<br>
                    ‚Ä¢ Velocidad TR ‚â§ 2.8 m/s<br>
                    ‚Ä¢ LA Strain ‚â• 23% (si disponible)
                `;
                ageReferences.style.display = 'block';
            } else {
                ageReferences.style.display = 'none';
            }
        }

        function calcularFuncionDiastolica() {
            const velocidadE = parseFloat(document.getElementById('velocidadE').value) || 0;
            const velocidadA = parseFloat(document.getElementById('velocidadA').value) || 0;
            const eSeptal = parseFloat(document.getElementById('eSeptal').value) || 0;
            const eLateral = parseFloat(document.getElementById('eLateral').value) || 0;
            const volumenAI = parseFloat(document.getElementById('volumenAI').value) || 0;
            const areaAI = parseFloat(document.getElementById('areaAI').value) || 0;
            const velocidadRT = parseFloat(document.getElementById('velocidadRT').value) || 0;
            const laStrain = parseFloat(document.getElementById('laStrain').value) || null;
            const fevi = parseFloat(document.getElementById('fevi').value) || null;
            const ritmo = document.getElementById('ritmo').value;
            const edad = parseInt(document.getElementById('edad').value) || 0;
            const tipoAI = document.getElementById('tipoAI').value;

            if (eSeptal === 0 || eLateral === 0 || edad === 0) {
                alert('Por favor, complete al menos los valores de e\\' septal, e\\' lateral y edad del paciente.');
                return;
            }

            const relacionEA = (ritmo === 'sinusal' && velocidadA > 0) ? velocidadE / velocidadA : null;
            const ePromedio = (eSeptal + eLateral) / 2;
            const relacionEeProm = ePromedio > 0 ? velocidadE / ePromedio : 0;

            let parametrosAlterados = 0;
            let parametrosEvaluados = 0;
            let statusParametros = [];

            let eeAlterado = false, aiAlterado = false, trAlterado = false;

            if (ritmo === 'sinusal' && relacionEA !== null) {
                parametrosEvaluados++;
                let eaStatus = 'normal';
                let eaRef = '';
                if (edad < 50) {
                    eaRef = '‚â•1.0';
                    if (relacionEA < 1.0) {
                        eaStatus = 'alterado';
                        parametrosAlterados++;
                    }
                } else if (edad < 65) {
                    eaRef = '0.8-2.0';
                    if (relacionEA < 0.8 || relacionEA > 2.0) {
                        eaStatus = 'alterado';
                        parametrosAlterados++;
                    }
                } else {
                    eaRef = '0.7-2.0';
                    if (relacionEA < 0.7 || relacionEA > 2.0) {
                        eaStatus = 'alterado';
                        parametrosAlterados++;
                    }
                }
                statusParametros.push({
                    nombre: 'Relaci√≥n E/A',
                    valor: relacionEA.toFixed(2),
                    status: eaStatus,
                    referencia: eaRef
                });
            }

            parametrosEvaluados++;
            let eStatus = 'normal';
            let eRef = '';
            if (edad < 50) {
                eRef = '‚â•10 cm/s';
                if (ePromedio < 10) {
                    eStatus = 'alterado';
                    parametrosAlterados++;
                }
            } else if (edad < 65) {
                eRef = '‚â•8 cm/s';
                if (ePromedio < 8) {
                    eStatus = 'alterado';
                    parametrosAlterados++;
                }
            } else {
                eRef = '‚â•6 cm/s';
                if (ePromedio < 6) {
                    eStatus = 'alterado';
                    parametrosAlterados++;
                }
            }
            statusParametros.push({
                nombre: "e' promedio",
                valor: ePromedio.toFixed(1) + ' cm/s',
                status: eStatus,
                referencia: eRef
            });

            if (relacionEeProm > 0) {
                parametrosEvaluados++;
                let eeStatus = 'normal';
                if (relacionEeProm > 14) {
                    eeStatus = 'alterado';
                    parametrosAlterados++;
                    eeAlterado = true;
                }
                statusParametros.push({
                    nombre: "Relaci√≥n E/e'",
                    valor: relacionEeProm.toFixed(1),
                    status: eeStatus,
                    referencia: '‚â§14'
                });
            }

            if (volumenAI > 0 || areaAI > 0) {
                parametrosEvaluados++;
                let aiStatus = 'normal';
                let aiValor = '';
                let aiRef = '';

                if (tipoAI === 'volumen' && volumenAI > 0) {
                    aiValor = volumenAI + ' ml/m¬≤';
                    aiRef = '‚â§34 ml/m¬≤';
                    if (volumenAI > 34) {
                        aiStatus = 'alterado';
                        parametrosAlterados++;
                        aiAlterado = true;
                    }
                } else if (tipoAI === 'area' && areaAI > 0) {
                    aiValor = areaAI + ' cm¬≤';
                    aiRef = '‚â§20 cm¬≤';
                    if (areaAI > 20) {
                        aiStatus = 'alterado';
                        parametrosAlterados++;
                        aiAlterado = true;
                    }
                }

                statusParametros.push({
                    nombre: tipoAI === 'volumen' ? 'Volumen AI indexado' : '√Årea AI',
                    valor: aiValor,
                    status: aiStatus,
                    referencia: aiRef
                });
            }

            if (velocidadRT > 0) {
                parametrosEvaluados++;
                let rtStatus = 'normal';
                if (velocidadRT > 2.8) {
                    rtStatus = 'alterado';
                    parametrosAlterados++;
                    trAlterado = true;
                }
                statusParametros.push({
                    nombre: 'Velocidad RT',
                    valor: velocidadRT + ' m/s',
                    status: rtStatus,
                    referencia: '‚â§2.8 m/s'
                });
            }

            if (laStrain !== null && laStrain > 0) {
                parametrosEvaluados++;
                let strainStatus = 'normal';
                if (laStrain < 23) {
                    strainStatus = 'alterado';
                    parametrosAlterados++;
                }
                statusParametros.push({
                    nombre: 'LA Strain (ASE 2025)',
                    valor: laStrain + '%',
                    status: strainStatus,
                    referencia: '‚â•23%'
                });
            }

            let grado = '';
            let gradoDetalle = '';
            let presionLlenado = '';
            let presionLlenadoClase = '';

            let criteriosElevados = 0;
            if (relacionEeProm > 14) criteriosElevados++;
            if (aiAlterado) criteriosElevados++;
            if (trAlterado) criteriosElevados++;

            if (criteriosElevados >= 2) {
                presionLlenado = 'Presiones de llenado elevadas';
                presionLlenadoClase = 'elevated';
            } else {
                presionLlenado = 'Presiones de llenado normales';
                presionLlenadoClase = 'normal';
            }

            if (ritmo === 'sinusal' && velocidadE > 0 && velocidadA > 0) {
                if (relacionEA < 0.8 && velocidadE <= 50) {
                    grado = 'Grado I (relajaci√≥n anormal)';
                    gradoDetalle = 'Patr√≥n de relajaci√≥n anormal: E/A < 0.8 y E ‚â§ 50 cm/s';
                } else if (relacionEA < 0.8 && velocidadE > 50) {
                    grado = 'Grado II (patr√≥n pseudonormal)';
                    gradoDetalle = 'E/A < 0.8 y E > 50 cm/s';
                } else if (relacionEA >= 0.8 && relacionEA <= 2.0) {
                    let alterados = 0;
                    if (eeAlterado) alterados++;
                    if (aiAlterado) alterados++;
                    if (trAlterado) alterados++;
                    if (alterados >= 2) {
                        grado = 'Grado II (patr√≥n pseudonormal)';
                        gradoDetalle = 'E/A 0.8-2.0 y ‚â•2 de: E/e\\'>14, AI alterada, TR>2.8 m/s';
                    } else {
                        grado = 'Normal';
                        gradoDetalle = 'Patr√≥n de llenado normal';
                    }
                } else if (relacionEA > 2.0) {
                    grado = 'Grado III (patr√≥n restrictivo)';
                    gradoDetalle = 'E/A > 2.0';
                }
            } else if (ritmo === 'fa') {
                grado = 'No aplicable (Fibrilaci√≥n Auricular)';
                gradoDetalle = 'El grado de disfunci√≥n diast√≥lica no se clasifica con el mismo algoritmo en FA. La evaluaci√≥n se centra en las presiones de llenado.';
            } else {
                grado = 'No aplicable (datos insuficientes)';
                gradoDetalle = 'Se requieren valores de E y A para clasificar el grado de disfunci√≥n diast√≥lica en ritmo sinusal.';
            }

            let diagnosticoPrincipal = '';
            let clasePrincipal = '';
            let recomendaciones = '';

            if (fevi !== null && fevi < 50) {
                document.getElementById('feviWarning').style.display = 'block';
                diagnosticoPrincipal = 'üî¥ DISFUNCI√ìN DIAST√ìLICA (FEVI <50%)';
                clasePrincipal = 'abnormal';
                recomendaciones = `
                    <h4>üìã Recomendaciones:</h4>
                    <ul>
                        <li>‚Ä¢ En pacientes con FEVI reducida, se asume disfunci√≥n diast√≥lica.</li>
                        <li>‚Ä¢ El foco principal es la estimaci√≥n de las presiones de llenado.</li>
                        <li>‚Ä¢ Optimizar el tratamiento de la insuficiencia card√≠aca.</li>
                        <li>‚Ä¢ Considerar biomarcadores (NT-proBNP/BNP).</li>
                        <li>‚Ä¢ Seguimiento ecocardiogr√°fico peri√≥dico.</li>
                    </ul>
                `;
            } else if (parametrosEvaluados < 3) {
                diagnosticoPrincipal = '‚ö†Ô∏è DATOS INSUFICIENTES';
                clasePrincipal = 'indeterminate';
                recomendaciones = `
                    <h4>üìã Recomendaciones:</h4>
                    <ul>
                        <li>‚Ä¢ Complete al menos 3 par√°metros para evaluaci√≥n confiable</li>
                        <li>‚Ä¢ Par√°metros evaluados: ${parametrosEvaluados}</li>
                        <li>‚Ä¢ Par√°metros m√≠nimos recomendados: e', E/e', LAVI/√Årea AI</li>
                    </ul>
                `;
            } else if (parametrosAlterados >= 3) {
                diagnosticoPrincipal = 'üî¥ DISFUNCI√ìN DIAST√ìLICA';
                clasePrincipal = 'abnormal';
                recomendaciones = `
                    <h4>üìã Recomendaciones:</h4>
                    <ul>
                        <li>‚Ä¢ Confirmar diagn√≥stico con contexto cl√≠nico</li>
                        <li>‚Ä¢ Evaluar s√≠ntomas de insuficiencia card√≠aca</li>
                        <li>‚Ä¢ Considerar biomarcadores (NT-proBNP/BNP)</li>
                        <li>‚Ä¢ Optimizar tratamiento de comorbilidades</li>
                        <li>‚Ä¢ Seguimiento ecocardiogr√°fico peri√≥dico</li>
                        ${ritmo === 'fa' ? '<li>‚Ä¢ Considerar ecocardiograf√≠a de estr√©s diast√≥lico</li>' : ''}
                    </ul>
                `;
            } else if (parametrosAlterados === 2) {
                diagnosticoPrincipal = 'üü° FUNCI√ìN DIAST√ìLICA INDETERMINADA';
                clasePrincipal = 'indeterminate';
                recomendaciones = `
                    <h4>üìã Recomendaciones:</h4>
                    <ul>
                        <li>‚Ä¢ Integrar con contexto cl√≠nico y s√≠ntomas</li>
                        <li>‚Ä¢ Considerar biomarcadores si hay s√≠ntomas</li>
                        <li>‚Ä¢ Evaluar ecocardiograf√≠a de estr√©s diast√≥lico</li>
                        <li>‚Ä¢ Reevaluar en 6-12 meses</li>
                        <li>‚Ä¢ Optimizar factores de riesgo cardiovascular</li>
                    </ul>
                `;
            } else {
                diagnosticoPrincipal = 'üü¢ FUNCI√ìN DIAST√ìLICA NORMAL';
                clasePrincipal = 'normal';
                recomendaciones = `
                    <h4>üìã Recomendaciones:</h4>
                    <ul>
                        <li>‚Ä¢ Funci√≥n diast√≥lica dentro de l√≠mites normales</li>
                        <li>‚Ä¢ Mantener control de factores de riesgo</li>
                        <li>‚Ä¢ Seguimiento seg√∫n indicaci√≥n cl√≠nica</li>
                        <li>‚Ä¢ Reevaluaci√≥n si aparecen s√≠ntomas</li>
                    </ul>
                `;
            }

            document.getElementById('feviWarning').style.display = (fevi !== null && fevi < 50) ? 'block' : 'none';
            document.getElementById('diagnostico').innerHTML = diagnosticoPrincipal + `<br><span style="font-size:0.9em;color:#eee;">(${parametrosAlterados}/${parametrosEvaluados} par√°metros alterados)</span>`;

            let gradoHtml = '';
            if (grado) {
                gradoHtml = `<div style="margin-top:10px;font-size:1.2em;"><b>Tipo de disfunci√≥n diast√≥lica:</b> ${grado}<br><span style="font-size:0.95em;color:#eee;">${gradoDetalle}</span></div>`;
                document.getElementById('diagnostico').innerHTML += gradoHtml;
            }

            document.getElementById('pressureStatus').textContent = presionLlenado;
            document.getElementById('pressureStatus').className = `pressure-status ${presionLlenadoClase}`;

            document.getElementById('results').className = `results ${clasePrincipal}`;
            document.getElementById('results').style.display = 'block';

            const statusHTML = statusParametros.map(param => `
                <div class="parameter-item ${param.status}">
                    <strong>${param.nombre}:</strong> ${param.valor}<br>
                    <small>Referencia: ${param.referencia}</small><br>
                    <small>Estado: ${param.status === 'alterado' ? '‚ùå Alterado' : '‚úÖ Normal'}</small>
                </div>
            `).join('');

            document.getElementById('parametros-status').innerHTML = statusHTML;
            document.getElementById('recomendaciones').innerHTML = recomendaciones;
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        document.addEventListener('DOMContentLoaded', function() {
            toggleAIInput();
            toggleEASection();
        });

        document.querySelectorAll('input[type="number"]').forEach(input => {
            input.addEventListener('input', function() {
                if (this.value < 0) this.value = 0;
            });
        });
    </script>
</body>
</html>'''
