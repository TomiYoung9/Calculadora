<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Función Diastólica - ASE 2025</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: linear-gradient(135deg, #2c3e50, #3498db); color: white; padding: 30px 20px 20px 20px; text-align: center; position: relative; }
        .header h1 { font-size: 2.2em; margin-bottom: 10px; }
        .form-container { padding: 40px; }
        .parameter-group { margin-bottom: 25px; padding: 20px; border: 2px solid #ecf0f1; border-radius: 10px; transition: all 0.3s ease; }
        .parameter-group:hover { border-color: #3498db; box-shadow: 0 5px 15px rgba(52, 152, 219, 0.1); }
        .parameter-group h3 { color: #2c3e50; margin-bottom: 15px; font-size: 1.3em; border-bottom: 2px solid #3498db; padding-bottom: 5px; }
        .input-row { display: flex; align-items: center; margin-bottom: 15px; flex-wrap: wrap; }
        .input-row label { flex: 1; min-width: 200px; font-weight: 600; color: #34495e; margin-right: 15px; }
        .input-row input, .input-row select { flex: 0 0 120px; padding: 10px; border: 2px solid #bdc3c7; border-radius: 5px; font-size: 16px; transition: border-color 0.3s ease; }
        .input-row input:focus, .input-row select:focus { outline: none; border-color: #3498db; }
        .unit { margin-left: 10px; color: #7f8c8d; font-weight: 500; }
        .optional { background: #f8f9fa; border-left: 4px solid #17a2b8; }
        .optional h3 { color: #17a2b8; border-bottom-color: #17a2b8; }
        .calculate-btn { width: 100%; padding: 15px; background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; border: none; border-radius: 10px; font-size: 1.2em; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-top: 20px; }
        .calculate-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(46, 204, 113, 0.3); }
        .results { margin-top: 30px; padding: 25px; border-radius: 10px; display: none; }
        .results.normal { background: linear-gradient(135deg, #2ecc71, #27ae60); color: white; }
        .results.abnormal { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; }
        .results.indeterminate { background: linear-gradient(135deg, #f39c12, #e67e22); color: white; }
        .results h3 { font-size: 1.5em; margin-bottom: 15px; }
        .parameter-status { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-top: 20px; }
        .parameter-item { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; border-left: 4px solid rgba(255,255,255,0.5); }
        .parameter-item.abnormal { border-left-color: #fff; background: rgba(255,255,255,0.2); }
        .recommendations { margin-top: 20px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 8px; }
        .info-box { background: #ecf0f1; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 5px solid #3498db; }
        .info-box h4 { color: #2c3e50; margin-bottom: 10px; }
        .info-box p { color: #34495e; line-height: 1.6; }
        .age-reference { background: #e8f4fd; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #3498db; }
        .fa-warning { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 8px; margin-top: 15px; color: #856404; }
        .fevi-warning { background: #fff8e1; border: 1px solid #ffecb3; padding: 15px; border-radius: 8px; margin-top: 15px; color: #6d4c41; }
        .referencias { margin-top: 40px; padding: 25px; background: #f8f9fa; border-radius: 10px; border-left: 5px solid #17a2b8; }
        .referencias h3 { color: #17a2b8; margin-bottom: 20px; font-size: 1.3em; }
        .referencia-item { margin-bottom: 15px; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .referencia-item p { margin: 0; line-height: 1.6; color: #2c3e50; }
        .referencia-item a { color: #3498db; text-decoration: none; font-weight: 500; }
        .referencia-item a:hover { color: #2980b9; text-decoration: underline; }
        .footer { background: #f4f7fa; text-align: center; padding: 25px 10px 15px 10px; border-top: 2px solid #e1e5e9; margin-top: 40px; color: #7f8c8d; }
        .ai-option-note { font-size: 0.9em; color: #666; margin-top: 10px; font-style: italic; }
        .pressure-status { font-size: 1.3em; font-weight: bold; margin-top: 15px; padding: 10px; border-radius: 8px; text-align: center; }
        .pressure-status.normal { background: rgba(255,255,255,0.2); color: white; }
        .pressure-status.elevated { background: rgba(255,255,255,0.3); color: white; }
        @media (max-width: 768px) { .input-row { flex-direction: column; align-items: stretch; } .input-row label { margin-bottom: 5px; margin-right: 0; } .input-row input, .input-row select { flex: 1; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🫀 Calculadora Función Diastólica ASE 2025</h1>
        </div>
        <div class="form-container">
            <div class="info-box">
                <h4>📋 Instrucciones</h4>
                <p>Complete los parámetros ecocardiográficos. Los valores de velocidad deben estar en cm/s para E, A, e' y en <b>m/s</b> para la velocidad de regurgitación tricuspídea (TR). El strain auricular y la FEVI son opcionales.</p>
            </div>
            <form id="diastolicForm">
                <div class="parameter-group">
                    <h3>🩺 Contexto Clínico</h3>
                    <div class="input-row">
                        <label>Ritmo cardíaco:</label>
                        <select id="ritmo" onchange="toggleEASection()">
                            <option value="sinusal">Ritmo sinusal</option>
                            <option value="fa">Fibrilación auricular</option>
                        </select>
                    </div>
                    <div class="input-row">
                        <label>Edad del paciente:</label>
                        <input type="number" id="edad" min="18" max="120" onchange="updateAgeReferences()">
                        <span class="unit">años</span>
                    </div>
                    <div class="input-row optional">
                        <label>FEVI (Fracción de eyección del VI):</label>
                        <input type="number" id="fevi" step="1" min="10" max="90" placeholder="Opcional">
                        <span class="unit">%</span>
                    </div>
                </div>
                <div id="ageReferences" class="age-reference" style="display:none;">
                    <h4>📊 Valores de referencia para esta edad:</h4>
                    <div id="ageReferenceContent"></div>
                </div>
                <div class="parameter-group" id="eaSection">
                    <h3>🔄 Flujo Mitral (Doppler Pulsado)</h3>
                    <div class="input-row">
                        <label>Velocidad de onda E:</label>
                        <input type="number" id="velocidadE" step="0.1" min="0" max="300">
                        <span class="unit">cm/s</span>
                    </div>
                    <div class="input-row">
                        <label>Velocidad de onda A:</label>
                        <input type="number" id="velocidadA" step="0.1" min="0" max="300">
                        <span class="unit">cm/s</span>
                    </div>
                </div>
                <div id="faWarning" class="fa-warning" style="display:none;">
                   ⚠️ <strong>Fibrilación Auricular:</strong> La relación E/A no se evaluará debido a la ausencia de onda A.
                </div>
                <div class="parameter-group">
                    <h3>🎯 Doppler Tisular</h3>
                    <div class="input-row">
                        <label>e' septal:</label>
                        <input type="number" id="eSeptal" step="0.1" min="0" max="30">
                        <span class="unit">cm/s</span>
                    </div>
                    <div class="input-row">
                        <label>e' lateral:</label>
                        <input type="number" id="eLateral" step="0.1" min="0" max="30">
                        <span class="unit">cm/s</span>
                    </div>
                </div>
                <div class="parameter-group">
                    <h3>📏 Aurícula Izquierda</h3>
                    <div class="input-row">
                        <label>Tipo de medición:</label>
                        <select id="tipoAI" onchange="toggleAIInput()">
                            <option value="volumen">Volumen indexado</option>
                            <option value="area">Área</option>
                        </select>
                    </div>
                    <div class="input-row" id="volumenRow">
                        <label>Volumen auricular izquierdo indexado:</label>
                        <input type="number" id="volumenAI" step="1" min="0" max="200">
                        <span class="unit">ml/m²</span>
                    </div>
                    <div class="input-row" id="areaRow" style="display:none;">
                        <label>Área auricular izquierda:</label>
                        <input type="number" id="areaAI" step="0.1" min="0" max="50">
                        <span class="unit">cm²</span>
                    </div>
                    <div class="ai-option-note">
                        <em>Complete uno u otro parámetro. Valores de referencia: Volumen ≤34 ml/m² o Área ≤20 cm²</em>
                    </div>
                </div>
                <div class="parameter-group">
                    <h3>🌊 Regurgitación Tricuspídea</h3>
                    <div class="input-row">
                        <label>Velocidad pico de regurgitación tricuspídea:</label>
                        <input type="number" id="velocidadRT" step="0.01" min="0" max="6">
                        <span class="unit">m/s</span>
                    </div>
                </div>
                <div class="parameter-group optional">
                    <h3>⭐ Strain Auricular Izquierdo (Opcional - ASE 2025)</h3>
                    <div class="input-row">
                        <label>LA Strain (strain auricular izquierdo):</label>
                        <input type="number" id="laStrain" step="1" min="0" max="60" placeholder="Opcional">
                        <span class="unit">%</span>
                    </div>
                    <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
                        <em>Si no está disponible, el algoritmo funcionará con los otros parámetros.</em>
                    </p>
                </div>
                <button type="button" class="calculate-btn" onclick="calcularFuncionDiastolica()">
                    🧮 Calcular Función Diastólica
                </button>
            </form>
            <div id="results" class="results">
                <div id="feviWarning" class="fevi-warning" style="display:none;">
                    ⚠️ <strong>FEVI Reducida:</strong> En pacientes con FEVI &lt;50%, se asume disfunción diastólica. Lo relevante es estimar la presión de llenado.
                </div>
                <h3 id="diagnostico"></h3>
                <div id="pressureStatus" class="pressure-status"></div>
                <div id="parametros-status" class="parameter-status"></div>
                <div id="recomendaciones" class="recommendations"></div>
            </div>
            
            <div class="referencias">
                <h3>📚 Referencias Bibliográficas</h3>
                <div class="referencia-item">
                    <p><strong>Nagueh SF, Smiseth OA, Appleton CP, et al.</strong> Recommendations for the Evaluation of Left Ventricular Diastolic Function by Echocardiography: An Update from the American Society of Echocardiography and the European Association of Cardiovascular Imaging. <em>J Am Soc Echocardiogr.</em> 2016;29(4):277-314. 
                    <a href="https://doi.org/10.1016/j.echo.2016.01.011" target="_blank" rel="noopener">doi:10.1016/j.echo.2016.01.011</a></p>
                </div>
                <div class="referencia-item">
                    <p><strong>American Society of Echocardiography.</strong> Guidelines for the Evaluation of Diastolic Function. Updated recommendations based on current evidence. 
                    <a href="https://www.asecho.org/" target="_blank" rel="noopener">Disponible en: www.asecho.org</a></p>
                </div>
            </div>
        </div>
        <div class="footer">
            <p>Calculadora basada en las guías ASE para evaluación de función diastólica</p>
        </div>
    </div>
    <script>
        // ... (el mismo bloque de JavaScript corregido y probado que te pasé antes)
    </script>
</body>
</html>
