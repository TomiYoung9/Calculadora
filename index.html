<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Función Diastólica - ASE 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --main-bg: #b7d0e8;
            --header-bg: #3a5a7a;
            --card-bg: #fff;
            --accent: #27ae60;
            --accent-dark: #219150;
            --accent-light: #e9f7ef;
            --text-main: #1a2a36;
            --text-soft: #5a6e7f;
            --border: #e3eaf2;
            --shadow: 0 4px 24px rgba(74,144,226,0.08);
            --red: #e74c3c;
            --green: #27ae60;
            --yellow: #f7b731;
        }
        body {
            font-family: 'Inter', Arial, sans-serif;
            background: var(--main-bg);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 900px;
            margin: 40px auto 0 auto;
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        .header {
            background: var(--header-bg);
            color: #fff;
            padding: 36px 20px 24px 20px;
            text-align: center;
        }
        .header h1 {
            font-family: 'Inter', Arial, sans-serif;
            font-size: 2.1em;
            font-weight: 700;
            margin: 0 0 8px 0;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 14px;
            color: #fff;
        }
        .header .subtitle {
            font-size: 1.08em;
            font-weight: 500;
            color: #fff;
            margin-top: 6px;
            letter-spacing: 0.2px;
        }
        .form-container {
            padding: 36px 22px 28px 22px;
        }
        .info-box {
            background: var(--accent-light);
            color: var(--text-main);
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 24px;
            font-size: 1.05em;
            box-shadow: 0 2px 8px #4a90e211;
        }
        .form-card {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 2px 8px #4a90e211;
            border: 1.5px solid var(--border);
            margin-bottom: 20px;
            padding: 22px 18px 12px 18px;
            transition: box-shadow 0.2s;
        }
        .form-card h3 {
            color: var(--text-main);
            font-size: 1.13em;
            font-weight: 600;
            margin-bottom: 14px;
            letter-spacing: 0.3px;
        }
        .input-row-group {
            display: flex;
            gap: 18px;
            flex-wrap: wrap;
        }
        .input-row {
            display: flex;
            align-items: center;
            margin-bottom: 14px;
            gap: 10px;
            flex: 1 1 220px;
            min-width: 220px;
        }
        .input-row label {
            font-weight: 500;
            color: var(--text-main);
            font-size: 1em;
            flex: 1 1 120px;
        }
        .input-row input, .input-row select {
            flex: 0 0 90px;
            padding: 9px 10px;
            border: 1.5px solid var(--border);
            border-radius: 6px;
            font-size: 1em;
            background: #f7fbfd;
            color: var(--text-main);
            transition: border-color 0.2s;
        }
        .input-row input:focus, .input-row select:focus {
            outline: none;
            border-color: var(--accent);
        }
        .unit {
            margin-left: 7px;
            color: var(--text-soft);
            font-weight: 500;
            font-size: 0.97em;
        }
        .ai-option-note {
            font-size: 0.92em;
            color: #5a6e7f;
            margin-top: 7px;
            font-style: italic;
        }
        .calculate-btn {
            width: 100%;
            padding: 13px;
            background: var(--green);
            color: white;
            border: none;
            border-radius: 9px;
            font-size: 1.13em;
            font-weight: 700;
            cursor: pointer;
            margin-top: 14px;
            box-shadow: 0 2px 8px #4a90e211;
            transition: background 0.2s, box-shadow 0.2s;
        }
        .calculate-btn:hover {
            background: var(--accent-dark);
            box-shadow: 0 6px 24px #4a90e122;
        }
        .results {
            margin-top: 26px;
            padding: 22px 18px;
            border-radius: 10px;
            display: none;
        }
        .results.normal { background: #eafaf1; color: var(--green); border: 2px solid var(--green);}
        .results.abnormal { background: #fdeaea; color: var(--red); border: 2px solid var(--red);}
        .results.indeterminate { background: #fffbe6; color: var(--yellow); border: 2px solid var(--yellow);}
        .results h3 { font-size: 1.2em; margin-bottom: 10px; }
        .parameter-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 10px;
            margin-top: 12px;
        }
        .parameter-item {
            background: rgba(255,255,255,0.13);
            padding: 10px 10px;
            border-radius: 7px;
            border-left: 4px solid #fff;
            font-size: 1em;
        }
        .parameter-item.abnormal { border-left-color: var(--red); }
        .parameter-item.normal { border-left-color: var(--green);}
        .parameter-item.indeterminate { border-left-color: var(--yellow);}
        .recommendations {
            margin-top: 12px;
            padding: 12px 10px;
            background: rgba(255,255,255,0.13);
            border-radius: 7px;
        }
        .fa-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px 12px;
            border-radius: 7px;
            margin-bottom: 12px;
            color: #856404;
            font-size: 1em;
        }
        .fevi-warning {
            background: #fff8e1;
            border: 1px solid #ffecb3;
            padding: 10px 12px;
            border-radius: 7px;
            margin-bottom: 12px;
            color: #6d4c41;
            font-size: 1em;
        }
        .tr-warning {
            background: #e3f1fd;
            border: 1.5px solid #b3d8f7;
            color: #357ab8;
            padding: 10px 12px;
            border-radius: 7px;
            margin-bottom: 12px;
            font-size: 1em;
            display: none;
        }
        .indeterminate-note {
            background: #fffbe6;
            border: 1.5px solid var(--yellow);
            color: #b38600;
            padding: 10px 12px;
            border-radius: 7px;
            margin-bottom: 12px;
            font-size: 1em;
        }
        .age-reference {
            background: #e8f4fd;
            padding: 10px 12px;
            border-radius: 7px;
            margin-bottom: 12px;
            border-left: 4px solid var(--accent);
        }
        .referencias {
            margin-top: 28px;
            padding: 16px 12px;
            background: #f8f9fa;
            border-radius: 9px;
            border-left: 5px solid var(--accent-light);
        }
        .referencias h3 {
            color: var(--text-main);
            margin-bottom: 12px;
            font-size: 1.08em;
        }
        .referencia-item {
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 7px;
            box-shadow: 0 2px 5px #4a90e20a;
        }
        .referencia-item p { margin: 0; line-height: 1.6; color: var(--text-main); }
        .referencia-item a { color: var(--accent); text-decoration: none; font-weight: 500; }
        .referencia-item a:hover { color: var(--accent-dark); text-decoration: underline; }
        .footer {
            background: #f4f7fa;
            text-align: center;
            padding: 16px 10px 10px 10px;
            border-top: 2px solid #e1e5e9;
            margin-top: 24px;
            color: #7f8c8d;
            font-size: 1em;
        }
        .twitter-section {
            text-align: center;
            padding: 10px;
            margin-bottom: 6px;
        }
        .twitter-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #111;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }
        .twitter-link:hover { color: var(--accent); }
        .twitter-icon { width: 24px; height: 24px; }
        .pressure-status {
            font-size: 1.08em;
            font-weight: bold;
            margin-top: 8px;
            padding: 7px;
            border-radius: 7px;
            text-align: center;
        }
        .pressure-status.normal { background: #eafaf1; color: var(--green);}
        .pressure-status.elevated { background: #fdeaea; color: var(--red);}
        @media (max-width: 768px) {
            .container { margin: 0; border-radius: 0; }
            .form-container { padding: 12px 2vw 12px 2vw; }
            .form-card { padding: 12px 4px 6px 4px; }
            .input-row-group { flex-direction: column; gap: 0; }
            .input-row { flex-direction: column; align-items: stretch; gap: 4px; min-width: 0;}
            .input-row label { margin-bottom: 2px; }
            .input-row input, .input-row select { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🫀 Calculadora de Función Diastólica</h1>
            <div class="subtitle">ASE 2025</div>
        </div>
        <div class="form-container">
            <div class="info-box">
                <strong>📋 Instrucciones:</strong> Complete los parámetros ecocardiográficos. Los valores de velocidad deben estar en <b>cm/s</b> para E, A, e' y en <b>m/s</b> para la velocidad de regurgitación tricuspídea (TR).
            </div>
            <form id="diastolicForm">
                <div class="form-card">
                    <h3>🩺 Contexto clínico</h3>
                    <div class="input-row-group">
                        <div class="input-row">
                            <label>Ritmo:</label>
                            <select id="ritmo" onchange="toggleEASection()">
                                <option value="sinusal">Ritmo sinusal</option>
                                <option value="fa">Fibrilación auricular</option>
                            </select>
                        </div>
                        <div class="input-row">
                            <label>Edad:</label>
                            <input type="number" id="edad" min="18" max="120" onchange="updateAgeReferences()" required>
                            <span class="unit">años</span>
                        </div>
                        <div class="input-row">
                            <label>FEVI:</label>
                            <input type="number" id="fevi" step="1" min="10" max="90" placeholder="Opcional">
                            <span class="unit">%</span>
                        </div>
                    </div>
                </div>
                <div id="ageReferences" class="age-reference" style="display:none;">
                    <strong>📊 Valores de referencia para esta edad:</strong>
                    <div id="ageReferenceContent"></div>
                </div>
                <div class="form-card" id="eaSection">
                    <h3>🔄 Flujo mitral (Doppler pulsado)</h3>
                    <div class="input-row-group">
                        <div class="input-row">
                            <label>Onda E:</label>
                            <input type="number" id="velocidadE" step="0.1" min="0" max="300">
                            <span class="unit">cm/s</span>
                        </div>
                        <div class="input-row">
                            <label>Onda A:</label>
                            <input type="number" id="velocidadA" step="0.1" min="0" max="300">
                            <span class="unit">cm/s</span>
                        </div>
                    </div>
                </div>
                <div id="faWarning" class="fa-warning" style="display:none;">
                   ⚠️ <strong>Fibrilación auricular:</strong> La relación E/A no se evaluará debido a la ausencia de onda A.
                </div>
                <div class="form-card">
                    <h3>🎯 Doppler tisular</h3>
                    <div class="input-row-group">
                        <div class="input-row">
                            <label>e' septal:</label>
                            <input type="number" id="eSeptal" step="0.1" min="0" max="30" required>
                            <span class="unit">cm/s</span>
                        </div>
                        <div class="input-row">
                            <label>e' lateral:</label>
                            <input type="number" id="eLateral" step="0.1" min="0" max="30" required>
                            <span class="unit">cm/s</span>
                        </div>
                    </div>
                </div>
                <div class="form-card">
                    <h3>📏 Aurícula izquierda</h3>
                    <div class="input-row-group">
                        <div class="input-row">
                            <label>Tipo de medición:</label>
                            <select id="tipoAI" onchange="toggleAIInput()">
                                <option value="volumen">Volumen indexado</option>
                                <option value="area">Área</option>
                            </select>
                        </div>
                        <div class="input-row" id="volumenRow">
                            <label>Vol AI indexado:</label>
                            <input type="number" id="volumenAI" step="1" min="0" max="200">
                            <span class="unit">ml/m²</span>
                        </div>
                        <div class="input-row" id="areaRow" style="display:none;">
                            <label>Área auricular izquierda:</label>
                            <input type="number" id="areaAI" step="0.1" min="0" max="50">
                            <span class="unit">cm²</span>
                        </div>
                    </div>
                    <div class="ai-option-note">
                        <em>Complete uno u otro parámetro. Valores de referencia: Volumen ≤34 ml/m² o Área ≤20 cm²</em>
                    </div>
                </div>
                <div class="form-card">
                    <h3>🌊 Regurgitación tricuspídea</h3>
                    <div class="input-row-group">
                        <div class="input-row">
                            <label>Velocidad pico de regurgitación tricuspídea:</label>
                            <input type="number" id="velocidadRT" step="0.01" min="0" max="6">
                            <span class="unit">m/s</span>
                        </div>
                    </div>
                </div>
                <div class="form-card">
                    <h3>⭐ Strain auricular izquierdo (ASE 2025)</h3>
                    <div class="input-row-group">
                        <div class="input-row">
                            <label>LA Strain:</label>
                            <input type="number" id="laStrain" step="1" min="0" max="60" placeholder="Opcional">
                            <span class="unit">%</span>
                        </div>
                    </div>
                    <div class="ai-option-note">
                        <em>Si no está disponible, el algoritmo funcionará con los otros parámetros.</em>
                    </div>
                </div>
                <div id="trWarning" class="tr-warning">
                    ℹ️ No se ingresó la velocidad de regurgitación tricuspídea. El algoritmo se adapta y utiliza los parámetros disponibles según las guías ASE.
                </div>
                <button type="button" class="calculate-btn" onclick="calcularFuncionDiastolica()">
                    🧮 Calcular función diastólica
                </button>
            </form>
            <div id="results" class="results">
                <div id="feviWarning" class="fevi-warning" style="display:none;">
                    ⚠️ <strong>FEVI reducida:</strong> En pacientes con FEVI &lt;50%, se asume disfunción diastólica. Lo relevante es estimar la presión de llenado.
                </div>
                <div id="trWarningResult" class="tr-warning" style="display:none;">
                    ℹ️ No se ingresó la velocidad de regurgitación tricuspídea. El algoritmo se adapta y utiliza los parámetros disponibles según las guías ASE.
                </div>
                <div id="indeterminateNote" class="indeterminate-note" style="display:none;">
                    Se dispone solo de dos parámetros y sus resultados son discordantes (uno normal y otro alterado), por lo que no es posible clasificar la función diastólica según las guías ASE/EACVI.
                </div>
                <h3 id="diagnostico"></h3>
                <div id="pressureStatus" class="pressure-status"></div>
                <div id="parametros-status" class="parameter-status"></div>
                <div id="recomendaciones" class="recommendations"></div>
            </div>
            <div class="referencias">
                <h3>📚 Referencias bibliográficas</h3>
                <div class="referencia-item">
                    <p><strong>Nagueh SF, Smiseth OA, Almeida AG, et al.</strong> Recommendations for the Evaluation of Left Ventricular Diastolic Function by Echocardiography: An Update from the American Society of Echocardiography and the European Association of Cardiovascular Imaging. <em>J Am Soc Echocardiogr</em>. 2025 Jul 3. [Epub ahead of print]. 
                    <a href="https://doi.org/10.1016/j.echo.2024.12.001" target="_blank" rel="noopener">https://doi.org/10.1016/j.echo.2024.12.001</a></p>
                </div>
                <div class="referencia-item">
                    <p><strong>Nagueh SF, Smiseth OA, Appleton CP, et al.</strong> Recommendations for the Evaluation of Left Ventricular Diastolic Function by Echocardiography: An Update from the American Society of Echocardiography and the European Association of Cardiovascular Imaging. <em>J Am Soc Echocardiogr</em>. 2016;29(4):277-314. 
                    <a href="https://doi.org/10.1016/j.echo.2016.01.011" target="_blank" rel="noopener">https://doi.org/10.1016/j.echo.2016.01.011</a></p>
                </div>
            </div>
        </div>
        <div class="twitter-section">
            <a href="https://x.com/atomasyoung" target="_blank" rel="noopener" class="twitter-link">
                <svg class="twitter-icon" viewBox="0 0 1200 1227" fill="currentColor">
                    <path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z"/>
                </svg>
                @atomasyoung
            </a>
        </div>
        <div class="footer">
            <p>Calculadora basada en las guías ASE para evaluación de función diastólica</p>
        </div>
    </div>
    <script>
        function toggleEASection() {
            const ritmo = document.getElementById('ritmo').value;
            const eaSection = document.getElementById('eaSection');
            const faWarning = document.getElementById('faWarning');
            if (ritmo === 'fa') {
                eaSection.style.display = 'none';
                faWarning.style.display = 'block';
                document.getElementById('velocidadE').value = '';
                document.getElementById('velocidadA').value = '';
            } else {
                eaSection.style.display = 'block';
                faWarning.style.display = 'none';
            }
        }

        function toggleAIInput() {
            const tipoAI = document.getElementById('tipoAI').value;
            const volumenRow = document.getElementById('volumenRow');
            const areaRow = document.getElementById('areaRow');
            if (tipoAI === 'volumen') {
                volumenRow.style.display = 'flex';
                areaRow.style.display = 'none';
                document.getElementById('areaAI').value = '';
            } else {
                volumenRow.style.display = 'none';
                areaRow.style.display = 'flex';
                document.getElementById('volumenAI').value = '';
            }
        }

        function updateAgeReferences() {
            const edad = parseInt(document.getElementById('edad').value);
            const ageReferences = document.getElementById('ageReferences');
            const ageReferenceContent = document.getElementById('ageReferenceContent');
            
            if (edad >= 18) {
                let eRef, eaRef;
                if (edad < 50) {
                    eRef = "e' promedio ≥ 10 cm/s";
                    eaRef = 'E/A ≥ 1.0';
                } else if (edad < 65) {
                    eRef = "e' promedio ≥ 8 cm/s";
                    eaRef = 'E/A: 0.8-2.0';
                } else {
                    eRef = "e' promedio ≥ 6 cm/s";
                    eaRef = 'E/A: 0.7-2.0';
                }
                
                ageReferenceContent.innerHTML = `
                    <strong>Edad ${edad} años:</strong><br>
                    • ${eRef}<br>
                    • ${eaRef}<br>
                    • E/e' ≤ 14<br>
                    • LAVI ≤ 34 ml/m² o Área AI ≤ 20 cm²<br>
                    • Velocidad TR ≤ 2.8 m/s<br>
                    • LA Strain ≥ 23% (si disponible)
                `;
                ageReferences.style.display = 'block';
            } else {
                ageReferences.style.display = 'none';
            }
        }

        function showTrWarning(show) {
            document.getElementById('trWarning').style.display = show ? 'block' : 'none';
            document.getElementById('trWarningResult').style.display = show ? 'block' : 'none';
        }

        function calcularFuncionDiastolica() {
            // Obtener valores
            const edad = parseInt(document.getElementById('edad').value);
            const ritmo = document.getElementById('ritmo').value;
            const fevi = parseFloat(document.getElementById('fevi').value);
            const velocidadE = parseFloat(document.getElementById('velocidadE').value);
            const velocidadA = parseFloat(document.getElementById('velocidadA').value);
            const eSeptal = parseFloat(document.getElementById('eSeptal').value);
            const eLateral = parseFloat(document.getElementById('eLateral').value);
            const tipoAI = document.getElementById('tipoAI').value;
            const volumenAI = parseFloat(document.getElementById('volumenAI').value);
            const areaAI = parseFloat(document.getElementById('areaAI').value);
            const velocidadRT = parseFloat(document.getElementById('velocidadRT').value);
            const laStrain = parseFloat(document.getElementById('laStrain').value);

            // Validaciones básicas
            if (!edad || !eSeptal || !eLateral) {
                alert('Por favor complete los campos obligatorios: Edad, e\' septal y e\' lateral');
                return;
            }

            // Calcular e' promedio
            const ePromedio = (eSeptal + eLateral) / 2;

            // Mostrar resultados
            const resultsDiv = document.getElementById('results');
            const diagnosticoDiv = document.getElementById('diagnostico');
            const parametrosDiv = document.getElementById('parametros-status');
            const recomendacionesDiv = document.getElementById('recomendaciones');
            const feviWarningDiv = document.getElementById('feviWarning');
            const trWarningResultDiv = document.getElementById('trWarningResult');
            const indeterminateNoteDiv = document.getElementById('indeterminateNote');
            const pressureStatusDiv = document.getElementById('pressureStatus');

            // Limpiar resultados previos
            resultsDiv.className = 'results';
            feviWarningDiv.style.display = 'none';
            trWarningResultDiv.style.display = 'none';
            indeterminateNoteDiv.style.display = 'none';

            // Verificar si falta velocidad TR
            const faltaTR = !velocidadRT || velocidadRT === 0;
            if (faltaTR) {
                trWarningResultDiv.style.display = 'block';
            }

            // Lógica para FEVI reducida
            if (fevi && fevi < 50) {
                feviWarningDiv.style.display = 'block';
                resultsDiv.className = 'results abnormal';
                diagnosticoDiv.textContent = 'Disfunción diastólica (FEVI reducida)';
                
                // Evaluar presiones de llenado
                let presionesElevadas = false;
                let parametrosPresion = [];

                // E/e' > 14
                if (velocidadE && ePromedio) {
                    const eEPrima = velocidadE / ePromedio;
                    if (eEPrima > 14) {
                        presionesElevadas = true;
                        parametrosPresion.push(`E/e': ${eEPrima.toFixed(1)} (>14)`);
                    } else {
                        parametrosPresion.push(`E/e': ${eEPrima.toFixed(1)} (≤14)`);
                    }
                }

                // Velocidad TR > 2.8 m/s
                if (velocidadRT) {
                    if (velocidadRT > 2.8) {
                        presionesElevadas = true;
                        parametrosPresion.push(`Velocidad TR: ${velocidadRT.toFixed(2)} m/s (>2.8)`);
                    } else {
                        parametrosPresion.push(`Velocidad TR: ${velocidadRT.toFixed(2)} m/s (≤2.8)`);
                    }
                }

                // Volumen/Área AI
                if (tipoAI === 'volumen' && volumenAI) {
                    if (volumenAI > 34) {
                        presionesElevadas = true;
                        parametrosPresion.push(`LAVI: ${volumenAI} ml/m² (>34)`);
                    } else {
                        parametrosPresion.push(`LAVI: ${volumenAI} ml/m² (≤34)`);
                    }
                } else if (tipoAI === 'area' && areaAI) {
                    if (areaAI > 20) {
                        presionesElevadas = true;
                        parametrosPresion.push(`Área AI: ${areaAI} cm² (>20)`);
                    } else {
                        parametrosPresion.push(`Área AI: ${areaAI} cm² (≤20)`);
                    }
                }

                // LA Strain < 23%
                if (laStrain) {
                    if (laStrain < 23) {
                        presionesElevadas = true;
                        parametrosPresion.push(`LA Strain: ${laStrain}% (<23%)`);
                    } else {
                        parametrosPresion.push(`LA Strain: ${laStrain}% (≥23%)`);
                    }
                }

                // Mostrar estado de presiones
                if (presionesElevadas) {
                    pressureStatusDiv.textContent = 'Presiones de llenado elevadas';
                    pressureStatusDiv.className = 'pressure-status elevated';
                } else {
                    pressureStatusDiv.textContent = 'Presiones de llenado normales';
                    pressureStatusDiv.className = 'pressure-status normal';
                }

                parametrosDiv.innerHTML = parametrosPresion.map(p => 
                    `<div class="parameter-item">${p}</div>`
                ).join('');

                recomendacionesDiv.innerHTML = `
                    <strong>Recomendaciones:</strong><br>
                    • Optimizar tratamiento de la insuficiencia cardíaca<br>
                    • Control de factores de riesgo cardiovascular<br>
                    • Seguimiento ecocardiográfico según evolución clínica
                `;

                resultsDiv.style.display = 'block';
                return;
            }

            // Algoritmo completo para FEVI ≥50% o no especificada
            let parametros = [];
            let parametrosNormales = 0;
            let parametrosAlterados = 0;
            let parametrosDisponibles = 0;

            // 1. e' promedio
            let ePromedioNormal;
            if (edad < 50) {
                ePromedioNormal = ePromedio >= 10;
            } else if (edad < 65) {
                ePromedioNormal = ePromedio >= 8;
            } else {
                ePromedioNormal = ePromedio >= 6;
            }

            parametros.push({
                nombre: `e' promedio: ${ePromedio.toFixed(1)} cm/s`,
                normal: ePromedioNormal,
                clase: ePromedioNormal ? 'normal' : 'abnormal'
            });
            parametrosDisponibles++;
            if (ePromedioNormal) parametrosNormales++; else parametrosAlterados++;

            // 2. E/A (solo en ritmo sinusal)
            if (ritmo === 'sinusal' && velocidadE && velocidadA && velocidadA > 0) {
                const eA = velocidadE / velocidadA;
                let eANormal;
                
                if (edad < 50) {
                    eANormal = eA >= 1.0;
                } else if (edad < 65) {
                    eANormal = eA >= 0.8 && eA <= 2.0;
                } else {
                    eANormal = eA >= 0.7 && eA <= 2.0;
                }

                parametros.push({
                    nombre: `E/A: ${eA.toFixed(2)}`,
                    normal: eANormal,
                    clase: eANormal ? 'normal' : 'abnormal'
                });
                parametrosDisponibles++;
                if (eANormal) parametrosNormales++; else parametrosAlterados++;
            }

            // 3. E/e'
            if (velocidadE && ePromedio) {
                const eEPrima = velocidadE / ePromedio;
                const eEPrimaNormal = eEPrima <= 14;

                parametros.push({
                    nombre: `E/e': ${eEPrima.toFixed(1)}`,
                    normal: eEPrimaNormal,
                    clase: eEPrimaNormal ? 'normal' : 'abnormal'
                });
                parametrosDisponibles++;
                if (eEPrimaNormal) parametrosNormales++; else parametrosAlterados++;
            }

            // 4. Volumen/Área AI
            if (tipoAI === 'volumen' && volumenAI) {
                const volumenNormal = volumenAI <= 34;
                parametros.push({
                    nombre: `LAVI: ${volumenAI} ml/m²`,
                    normal: volumenNormal,
                    clase: volumenNormal ? 'normal' : 'abnormal'
                });
                parametrosDisponibles++;
                if (volumenNormal) parametrosNormales++; else parametrosAlterados++;
            } else if (tipoAI === 'area' && areaAI) {
                const areaNormal = areaAI <= 20;
                parametros.push({
                    nombre: `Área AI: ${areaAI} cm²`,
                    normal: areaNormal,
                    clase: areaNormal ? 'normal' : 'abnormal'
                });
                parametrosDisponibles++;
                if (areaNormal) parametrosNormales++; else parametrosAlterados++;
            }

            // 5. Velocidad TR
            if (velocidadRT) {
                const trNormal = velocidadRT <= 2.8;
                parametros.push({
                    nombre: `Velocidad TR: ${velocidadRT.toFixed(2)} m/s`,
                    normal: trNormal,
                    clase: trNormal ? 'normal' : 'abnormal'
                });
                parametrosDisponibles++;
                if (trNormal) parametrosNormales++; else parametrosAlterados++;
            }

            // 6. LA Strain (ASE 2025)
            if (laStrain) {
                const strainNormal = laStrain >= 23;
                parametros.push({
                    nombre: `LA Strain: ${laStrain}%`,
                    normal: strainNormal,
                    clase: strainNormal ? 'normal' : 'abnormal'
                });
                parametrosDisponibles++;
                if (strainNormal) parametrosNormales++; else parametrosAlterados++;
            }

            // Determinar diagnóstico
            let diagnostico, clase, recomendaciones;

            if (parametrosDisponibles < 3) {
                diagnostico = 'Datos insuficientes para evaluación';
                clase = 'indeterminate';
                recomendaciones = 'Se requieren al menos 3 parámetros para una evaluación adecuada según las guías ASE/EACVI.';
            } else if (parametrosAlterados === 0) {
                diagnostico = 'Función diastólica normal';
                clase = 'normal';
                recomendaciones = 'Función diastólica normal. Continuar con controles de rutina según indicación clínica.';
            } else if (parametrosAlterados >= 2) {
                // Determinar grado de disfunción
                if (velocidadE && velocidadA && velocidadA > 0) {
                    const eA = velocidadE / velocidadA;
                    if (eA < 0.8) {
                        diagnostico = 'Disfunción diastólica grado I (alteración de la relajación)';
                    } else if (eA >= 0.8 && eA <= 2.0) {
                        diagnostico = 'Disfunción diastólica grado II (patrón pseudonormal)';
                    } else {
                        diagnostico = 'Disfunción diastólica grado III (patrón restrictivo)';
                    }
                } else {
                    diagnostico = 'Disfunción diastólica';
                }
                clase = 'abnormal';
                recomendaciones = `
                    <strong>Recomendaciones:</strong><br>
                    • Control de factores de riesgo cardiovascular<br>
                    • Optimización del tratamiento antihipertensivo si corresponde<br>
                    • Control de diabetes mellitus si presente<br>
                    • Seguimiento ecocardiográfico según evolución clínica<br>
                    • Considerar evaluación cardiológica especializada
                `;
            } else if (parametrosDisponibles === 2 && parametrosAlterados === 1) {
                diagnostico = 'Función diastólica indeterminada';
                clase = 'indeterminate';
                indeterminateNoteDiv.style.display = 'block';
                recomendaciones = `
                    <strong>Recomendaciones:</strong><br>
                    • Se requieren parámetros adicionales para clasificación definitiva<br>
                    • Considerar medición de LA Strain si está disponible<br>
                    • Evaluar velocidad de regurgitación tricuspídea<br>
                    • Correlación clínica importante<br>
                    • Seguimiento ecocardiográfico
                `;
            } else {
                diagnostico = 'Función diastólica normal';
                clase = 'normal';
                recomendaciones = 'Función diastólica normal. Continuar con controles de rutina según indicación clínica.';
            }

            // Mostrar resultados
            resultsDiv.className = `results ${clase}`;
            diagnosticoDiv.textContent = diagnostico;
            
            parametrosDiv.innerHTML = parametros.map(p => 
                `<div class="parameter-item ${p.clase}">${p.nombre}</div>`
            ).join('');

            recomendacionesDiv.innerHTML = recomendaciones;
            resultsDiv.style.display = 'block';
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar eventos
            document.getElementById('velocidadRT').addEventListener('input', function() {
                const valor = parseFloat(this.value);
                showTrWarning(!valor || valor === 0);
            });
        });
    </script>
</body>
</html>
