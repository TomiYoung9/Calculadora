<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Funci√≥n Diast√≥lica </title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --main-bg: #b7d0e8;
            --header-bg: #3a5a7a;
            --card-bg: #fff;
            --accent: #27ae60;
            --accent-dark: #219150;
            --accent-light: #e9f7ef;
            --text-main: #1a2a36;
            --text-soft: #5a6e7f;
            --border: #e3eaf2;
            --shadow: 0 4px 24px rgba(74,144,226,0.08);
            --red: #e74c3c;
            --green: #27ae60;
            --yellow: #f7b731;
            --blue: #3498db;
        }
        body {
            font-family: 'Inter', Arial, sans-serif;
            background: var(--main-bg);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 900px;
            margin: 40px auto 0 auto;
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        .header {
            background: var(--header-bg);
            color: #fff;
            padding: 36px 20px 24px 20px;
            text-align: center;
        }
        .header h1 {
            font-family: 'Inter', Arial, sans-serif;
            font-size: 2.1em;
            font-weight: 700;
            margin: 0 0 8px 0;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 14px;
            color: #fff;
        }
        .header .subtitle {
            font-size: 1.08em;
            font-weight: 500;
            color: #fff;
            margin-top: 6px;
            letter-spacing: 0.2px;
        }
        .form-container {
            padding: 36px 22px 28px 22px;
        }
        .info-box {
            background: var(--accent-light);
            color: var(--text-main);
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 24px;
            font-size: 1.05em;
            box-shadow: 0 2px 8px #4a90e211;
        }
        .form-card {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 2px 8px #4a90e211;
            border: 1.5px solid var(--border);
            margin-bottom: 20px;
            padding: 22px 18px 12px 18px;
            transition: box-shadow 0.2s;
        }
        .form-card h3 {
            color: var(--text-main);
            font-size: 1.13em;
            font-weight: 600;
            margin-bottom: 14px;
            letter-spacing: 0.3px;
        }
        .input-row-group {
            display: flex;
            gap: 18px;
            flex-wrap: wrap;
        }
        .input-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
            flex: 1 1 220px;
            min-width: 220px;
        }
        .input-row label {
            font-weight: 500;
            color: var(--text-main);
            font-size: 1em;
            flex: 1 1 120px;
        }
        .input-row input, .input-row select {
            flex: 0 0 90px;
            padding: 9px 10px;
            border: 1.5px solid var(--border);
            border-radius: 6px;
            font-size: 1em;
            background: #f7fbfd;
            color: var(--text-main);
            transition: border-color 0.2s;
        }
        .input-row input:focus, .input-row select:focus {
            outline: none;
            border-color: var(--accent);
        }
        .unit {
            margin-left: 7px;
            color: var(--text-soft);
            font-weight: 500;
            font-size: 0.97em;
        }
        .ai-option-note {
            font-size: 0.92em;
            color: #5a6e7f;
            margin-top: 7px;
            font-style: italic;
        }
        .calculate-btn {
            width: 100%;
            padding: 13px;
            background: var(--green);
            color: white;
            border: none;
            border-radius: 9px;
            font-size: 1.13em;
            font-weight: 700;
            cursor: pointer;
            margin-top: 14px;
            box-shadow: 0 2px 8px #4a90e211;
            transition: background 0.2s, box-shadow 0.2s;
        }
        .calculate-btn:hover {
            background: var(--accent-dark);
            box-shadow: 0 6px 24px #4a90e122;
        }
        .results {
            margin-top: 26px;
            padding: 22px 18px;
            border-radius: 10px;
            display: none;
        }
        .results.normal { background: #eafaf1; color: var(--green); border: 2px solid var(--green);}
        .results.abnormal { background: #fdeaea; color: var(--red); border: 2px solid var(--red);}
        .results.indeterminate { background: #fffbe6; color: var(--yellow); border: 2px solid var(--yellow);}
        .results h3 { font-size: 1.2em; margin-bottom: 10px; }
        .parameter-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 6px;
            margin-top: 12px;
        }
        .parameter-item {
            background: rgba(255,255,255,0.13);
            padding: 7px 10px;
            border-radius: 7px;
            border-left: 4px solid #fff;
            font-size: 1em;
            margin-bottom: 0;
        }
        .parameter-item.abnormal { border-left-color: var(--red); background: #fdeaea;}
        .parameter-item.normal { border-left-color: var(--green); background: #eafaf1;}
        .parameter-item.indeterminate { border-left-color: var(--yellow); background: #fffbe6;}
        .recommendations {
            margin-top: 12px;
            padding: 12px 10px;
            background: rgba(255,255,255,0.13);
            border-radius: 7px;
        }
        .fa-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px 12px;
            border-radius: 7px;
            margin-bottom: 12px;
            color: #856404;
            font-size: 1em;
        }
        .fevi-warning {
            background: #fff8e1;
            border: 1px solid #ffecb3;
            padding: 10px 12px;
            border-radius: 7px;
            margin-bottom: 12px;
            color: #6d4c41;
            font-size: 1em;
        }
        .tr-warning {
            background: #e3f1fd;
            border: 1.5px solid #b3d8f7;
            color: #357ab8;
            padding: 10px 12px;
            border-radius: 7px;
            margin-bottom: 12px;
            font-size: 1em;
            display: none;
        }
        .indeterminate-note {
            background: #fffbe6;
            border: 1.5px solid var(--yellow);
            color: #b38600;
            padding: 10px 12px;
            border-radius: 7px;
            margin-bottom: 12px;
            font-size: 1em;
        }
        .age-reference {
            background: #e8f4fd;
            padding: 10px 12px;
            border-radius: 7px;
            margin-bottom: 12px;
            border-left: 4px solid var(--accent);
        }
        .referencias {
            margin-top: 28px;
            padding: 16px 12px;
            background: #f8f9fa;
            border-radius: 9px;
            border-left: 5px solid var(--accent-light);
        }
        .referencias h3 {
            color: var(--text-main);
            margin-bottom: 12px;
            font-size: 1.08em;
        }
        .referencia-item {
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 7px;
            box-shadow: 0 2px 5px #4a90e20a;
        }
        .referencia-item p { margin: 0; line-height: 1.6; color: var(--text-main); }
        .referencia-item a { color: var(--accent); text-decoration: none; font-weight: 500; }
        .referencia-item a:hover { color: var(--accent-dark); text-decoration: underline; }
        .twitter-section {
            text-align: center;
            padding: 10px;
            margin-bottom: 6px;
        }
        .twitter-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #111;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }
        .twitter-link:hover { color: var(--accent); }
        .twitter-icon { width: 24px; height: 24px; }
        .pressure-status {
            font-size: 1.08em;
            font-weight: bold;
            margin-top: 8px;
            padding: 7px;
            border-radius: 7px;
            text-align: center;
        }
        .pressure-status.normal { background: #eafaf1; color: var(--green);}
        .pressure-status.elevated { background: #fdeaea; color: var(--red);}
        
        @media (max-width: 768px) {
            .container { margin: 0; border-radius: 0; }
            .form-container { padding: 2px 0.5vw 2px 0.5vw; }
            .form-card { 
                padding: 6px 2px 2px 2px; 
                margin-bottom: 2px;
            }
            .form-card h3 {
                font-size: 1em;
                margin-bottom: 6px;
            }
            .input-row-group { 
                flex-direction: column; 
                gap: 0; 
                margin: 0;
            }
            .input-row { 
                flex-direction: column; 
                align-items: stretch; 
                gap: 0; 
                min-width: 0; 
                margin-bottom: 1px;
                padding: 0;
            }
            .input-row label { 
                margin-bottom: 1px; 
                font-size: 0.97em;
            }
            .input-row input, .input-row select { 
                width: 100%; 
                font-size: 0.97em;
                padding: 7px 7px;
            }
            .parameter-status { 
                grid-template-columns: 1fr; 
                gap: 0; 
                margin-top: 2px;
            }
            .parameter-item { 
                padding: 2px 3px; 
                font-size: 0.95em; 
                margin-bottom: 0;
            }
            .results { 
                padding: 3px 1px; 
            }
            .info-box, .fa-warning, .fevi-warning, .tr-warning, .indeterminate-note, .age-reference, .recommendations {
                padding: 7px 6px;
                font-size: 0.97em;
            }
            .referencias {
                padding: 7px 6px;
                font-size: 0.97em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü´Ä Calculadora de Funci√≥n Diast√≥lica</h1>
            <div class="subtitle"></div>
        </div>
        <div class="form-container">
            <div class="info-box">
                <strong>üìã Instrucciones:</strong> Complete los par√°metros ecocardiogr√°ficos. Los valores de velocidad deben estar en <b>cm/s</b> para E, A, e' y en <b>m/s</b> para la velocidad de regurgitaci√≥n tricusp√≠dea (TR).
            </div>
            <form id="diastolicForm">
                <div class="form-card">
                    <h3>ü©∫ Contexto cl√≠nico</h3>
                    <div class="input-row-group">
                        <div class="input-row">
                            <label>Ritmo:</label>
                            <select id="ritmo" onchange="toggleEASection();updateAgeReferences();">
                                <option value="sinusal">Ritmo sinusal</option>
                                <option value="fa">Fibrilaci√≥n auricular</option>
                            </select>
                        </div>
                        <div class="input-row">
                            <label>Edad:</label>
                            <select id="edad" onchange="updateAgeReferences()">
                                <option value="1">&lt;50 a√±os</option>
                                <option value="2">50-64 a√±os</option>
                                <option value="3">&ge;65 a√±os</option>
                            </select>
                        </div>
                        <div class="input-row">
                            <label>FEVI:</label>
                            <select id="fevi" onchange="updateAgeReferences()">
                                <option value="mayorigual">‚â•50%</option>
                                <option value="menor">&lt;50%</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div id="ageReferences" class="age-reference" style="display:none;">
                    <strong>üìä Valores de referencia para este perfil:</strong>
                    <div id="ageReferenceContent"></div>
                </div>
                <div class="form-card" id="eaSection">
                    <h3>üîÑ Flujo mitral (Doppler pulsado)</h3>
                    <div class="input-row-group">
                        <div class="input-row">
                            <label>Onda E:</label>
                            <input type="number" id="velocidadE" step="0.1" min="0" max="300">
                            <span class="unit">cm/s</span>
                        </div>
                        <div class="input-row">
                            <label>Onda A:</label>
                            <input type="number" id="velocidadA" step="0.1" min="0" max="300">
                            <span class="unit">cm/s</span>
                        </div>
                    </div>
                </div>
                <div id="faWarning" class="fa-warning" style="display:none;">
                   ‚ö†Ô∏è <strong>Fibrilaci√≥n auricular:</strong> La relaci√≥n E/A no se evaluar√°. Se utilizar√° algoritmo espec√≠fico para FA seg√∫n ASE 2025.
                </div>
                <div class="form-card">
                    <h3>üéØ Doppler tisular</h3>
                    <div class="input-row-group">
                        <div class="input-row">
                            <label>e' lateral:</label>
                            <input type="number" id="eLateral" step="0.1" min="0" max="30" required>
                            <span class="unit">cm/s</span>
                        </div>
                        <div class="input-row">
                            <label>e' septal:</label>
                            <input type="number" id="eSeptal" step="0.1" min="0" max="30" required>
                            <span class="unit">cm/s</span>
                        </div>
                    </div>
                </div>
                <div class="form-card">
                    <h3>üìè Aur√≠cula izquierda</h3>
                    <div class="input-row-group">
                        <div class="input-row">
                            <label>Tipo de medici√≥n:</label>
                            <select id="tipoAI" onchange="toggleAIInput();updateAgeReferences();">
                                <option value="volumen">Volumen indexado</option>
                                <option value="area">√Årea</option>
                            </select>
                        </div>
                        <div class="input-row" id="volumenRow">
                            <label>Vol AI indexado:</label>
                            <input type="number" id="volumenAI" step="1" min="0" max="200">
                            <span class="unit">ml/m¬≤</span>
                        </div>
                        <div class="input-row" id="areaRow" style="display:none;">
                            <label>√Årea auricular izquierda:</label>
                            <input type="number" id="areaAI" step="0.1" min="0" max="50">
                            <span class="unit">cm¬≤</span>
                        </div>
                    </div>
                    <div class="ai-option-note">
                        <em>Complete uno u otro par√°metro. Valores de referencia: Volumen ‚â§34 ml/m¬≤ o √Årea ‚â§20 cm¬≤</em>
                    </div>
                </div>
                <div class="form-card">
                    <h3>üåä Regurgitaci√≥n tricusp√≠dea</h3>
                    <div class="input-row-group">
                        <div class="input-row">
                            <label>Velocidad pico de regurgitaci√≥n tricusp√≠dea:</label>
                            <input type="number" id="velocidadRT" step="0.01" min="0" max="6">
                            <span class="unit">m/s</span>
                        </div>
                    </div>
                </div>
                <div class="form-card">
                    <h3>‚≠ê Strain auricular izquierdo</h3>
                    <div class="input-row-group">
                        <div class="input-row">
                            <label>LA Strain:</label>
                            <input type="number" id="laStrain" step="1" min="0" max="60" placeholder="Opcional">
                            <span class="unit">%</span>
                        </div>
                    </div>
                </div>
                <div id="trWarning" class="tr-warning">
                    ‚ÑπÔ∏è No se ingres√≥ la velocidad de regurgitaci√≥n tricusp√≠dea. El algoritmo se adapta y utiliza los par√°metros disponibles seg√∫n las gu√≠as ASE.
                </div>
                <button type="button" class="calculate-btn" onclick="calcularFuncionDiastolica()">
                    üßÆ Calcular funci√≥n diast√≥lica
                </button>
            </form>
            <div id="results" class="results">
                <div id="feviWarning" class="fevi-warning" style="display:none;">
                    ‚ö†Ô∏è <strong>FEVI reducida:</strong> En pacientes con FEVI &lt;50%, se asume disfunci√≥n diast√≥lica. Lo relevante es estimar la presi√≥n de llenado.
                </div>
                <div id="trWarningResult" class="tr-warning" style="display:none;">
                    ‚ÑπÔ∏è No se ingres√≥ la velocidad de regurgitaci√≥n tricusp√≠dea. El algoritmo se adapta y utiliza los par√°metros disponibles seg√∫n las gu√≠as ASE.
                </div>
                <div id="indeterminateNote" class="indeterminate-note" style="display:none;">
                    Se dispone solo de dos par√°metros y sus resultados son discordantes (uno normal y otro alterado), por lo que no es posible clasificar la funci√≥n diast√≥lica seg√∫n las gu√≠as ASE/EACVI.
                </div>
                <h3 id="diagnostico"></h3>
                <div id="pressureStatus" class="pressure-status"></div>
                <div id="parametros-status" class="parameter-status"></div>
                <div id="recomendaciones" class="recommendations"></div>
            </div>
<div class="referencias">
    <h3>üìö Referencia</h3>
    <div class="referencia-item">
        <p>
            <strong>ASE 2025. Left Ventricular Diastolic Function by Echo</strong><br>
            <a href="https://www.asecho.org/guideline/left-ventricular-diastolic-function-by-echo/" target="_blank" rel="noopener">
                https://www.asecho.org/guideline/left-ventricular-diastolic-function-by-echo/
            </a>
        </p>
    </div>
</div>
        <div class="twitter-section">
            <a href="https://x.com/atomasyoung" target="_blank" rel="noopener" class="twitter-link">
                <svg class="twitter-icon" viewBox="0 0 1200 1227" fill="currentColor">
                    <path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z"/>
                </svg>
                @atomasyoung
            </a>
        </div>
    </div>
    <script>
        // Mostrar/ocultar secci√≥n E/A seg√∫n ritmo
        function toggleEASection() {
            const ritmo = document.getElementById('ritmo').value;
            const eaSection = document.getElementById('eaSection');
            const faWarning = document.getElementById('faWarning');
            if (ritmo === 'fa') {
                eaSection.style.display = 'none';
                faWarning.style.display = 'block';
                document.getElementById('velocidadE').value = '';
                document.getElementById('velocidadA').value = '';
            } else {
                eaSection.style.display = 'block';
                faWarning.style.display = 'none';
            }
        }
        // Mostrar/ocultar input de √°rea/volumen AI
        function toggleAIInput() {
            const tipoAI = document.getElementById('tipoAI').value;
            const volumenRow = document.getElementById('volumenRow');
            const areaRow = document.getElementById('areaRow');
            if (tipoAI === 'volumen') {
                volumenRow.style.display = 'flex';
                areaRow.style.display = 'none';
                document.getElementById('areaAI').value = '';
            } else {
                volumenRow.style.display = 'none';
                areaRow.style.display = 'flex';
                document.getElementById('volumenAI').value = '';
            }
        }
        // Mostrar valores de referencia seg√∫n edad, ritmo, FEVI y tipo de AI
        function updateAgeReferences() {
            const edad = document.getElementById('edad').value;
            const ritmo = document.getElementById('ritmo').value;
            const fevi = document.getElementById('fevi').value;
            const tipoAI = document.getElementById('tipoAI').value;
            const ageReferences = document.getElementById('ageReferences');
            const ageReferenceContent = document.getElementById('ageReferenceContent');
            let eRef, eaRef, edadTexto, eSeptalRef, eLateralRef, aiRef;
            if (edad === "1") {
                edadTexto = "&lt;50 a√±os";
                eRef = "e' promedio ‚â• 10 cm/s";
                eaRef = 'E/A ‚â• 1.0';
                eSeptalRef = "‚â•8.0";
                eLateralRef = "‚â•10.0";
            } else if (edad === "2") {
                edadTexto = "50-64 a√±os";
                eRef = "e' promedio ‚â• 8 cm/s";
                eaRef = 'E/A: 0.8-2.0';
                eSeptalRef = "‚â•6.5";
                eLateralRef = "‚â•8.5";
            } else {
                edadTexto = "&ge;65 a√±os";
                eRef = "e' promedio ‚â• 6 cm/s";
                eaRef = 'E/A: 0.7-2.0';
                eSeptalRef = "‚â•5.0";
                eLateralRef = "‚â•7.0";
            }
            aiRef = tipoAI === "volumen" ? "Volumen AI indexado ‚â§34 ml/m¬≤" : "√Årea AI ‚â§20 cm¬≤";
            let ritmoRef = "";
            if (ritmo === "fa") {
                ritmoRef = "<br>‚Ä¢ En FA no se utiliza E/A";
            }
            let feviRef = "";
            if (fevi === "menor") {
                feviRef = "<br>‚Ä¢ FEVI reducida: se asume disfunci√≥n diast√≥lica";
            }
            ageReferenceContent.innerHTML = `
                <strong>Edad ${edadTexto}:</strong><br>
                ‚Ä¢ ${eRef} (lateral ${eLateralRef} cm/s, septal ${eSeptalRef} cm/s)<br>
                ‚Ä¢ ${eaRef}${ritmoRef}<br>
                ‚Ä¢ E/e' ‚â§ 14<br>
                ‚Ä¢ ${aiRef}<br>
                ‚Ä¢ Velocidad TR ‚â§ 2.8 m/s<br>
                ‚Ä¢ LA Strain ‚â• 23%
                ${feviRef}
            `;
            ageReferences.style.display = 'block';
        }
        // Mostrar advertencia si falta TR
        function showTrWarning(show) {
            document.getElementById('trWarning').style.display = show ? 'block' : 'none';
            document.getElementById('trWarningResult').style.display = show ? 'block' : 'none';
        }
        // Salto autom√°tico al siguiente input
        document.addEventListener('DOMContentLoaded', function() {
            let inputs = Array.from(document.querySelectorAll('input,select')).filter(el => el.offsetParent !== null);
            document.querySelectorAll('input,select').forEach((el, idx, arr) => {
                el.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        let next = arr[idx + 1];
                        while (next && next.offsetParent === null) next = arr[++idx + 1];
                        if (next) next.focus();
                    }
                });
            });
            document.getElementById('velocidadRT').addEventListener('input', function() {
                const valor = parseFloat(this.value);
                showTrWarning(!valor || valor === 0);
            });
            updateAgeReferences();
        });
        // L√≥gica principal de c√°lculo
        function calcularFuncionDiastolica() {
            // Obtener valores
            const ritmo = document.getElementById('ritmo').value;
            const edad = document.getElementById('edad').value;
            const fevi = document.getElementById('fevi').value;
            const eSeptal = parseFloat(document.getElementById('eSeptal').value);
            const eLateral = parseFloat(document.getElementById('eLateral').value);
            const tipoAI = document.getElementById('tipoAI').value;
            const volumenAI = parseFloat(document.getElementById('volumenAI').value);
            const areaAI = parseFloat(document.getElementById('areaAI').value);
            const velocidadRT = parseFloat(document.getElementById('velocidadRT').value);
            const laStrain = parseFloat(document.getElementById('laStrain').value);
            let velocidadE = null, velocidadA = null, ea = null;
            if (ritmo === "sinusal") {
                velocidadE = parseFloat(document.getElementById('velocidadE').value);
                velocidadA = parseFloat(document.getElementById('velocidadA').value);
                if (!isNaN(velocidadE) && !isNaN(velocidadA) && velocidadA > 0) {
                    ea = velocidadE / velocidadA;
                }
            }
            // Referencias seg√∫n edad
            let eSeptalRef, eLateralRef, ePromRef, eaMin, eaMax;
            if (edad === "1") {
                eSeptalRef = 8.0;
                eLateralRef = 10.0;
                ePromRef = 10;
                eaMin = 1.0; eaMax = 99;
            } else if (edad === "2") {
                eSeptalRef = 6.5;
                eLateralRef = 8.5;
                ePromRef = 8;
                eaMin = 0.8; eaMax = 2.0;
            } else {
                eSeptalRef = 5.0;
                eLateralRef = 7.0;
                ePromRef = 6;
                eaMin = 0.7; eaMax = 2.0;
            }
            // Estado de par√°metros
            let parametros = [];
            // e' lateral
            let eLateralNormal = eLateral >= eLateralRef;
            parametros.push({
                nombre: "e' lateral",
                valor: isNaN(eLateral) ? "‚Äî" : eLateral.toFixed(1) + " cm/s",
                estado: isNaN(eLateral) ? "indeterminate" : (eLateralNormal ? "normal" : "abnormal"),
                referencia: "‚â•" + eLateralRef + " cm/s"
            });
            // e' septal
            let eSeptalNormal = eSeptal >= eSeptalRef;
            parametros.push({
                nombre: "e' septal",
                valor: isNaN(eSeptal) ? "‚Äî" : eSeptal.toFixed(1) + " cm/s",
                estado: isNaN(eSeptal) ? "indeterminate" : (eSeptalNormal ? "normal" : "abnormal"),
                referencia: "‚â•" + eSeptalRef + " cm/s"
            });
            // e' promedio
            let eProm = (eSeptal + eLateral) / 2;
            let ePromNormal = eProm >= ePromRef;
            parametros.push({
                nombre: "e' promedio",
                valor: isNaN(eProm) ? "‚Äî" : eProm.toFixed(1) + " cm/s",
                estado: isNaN(eProm) ? "indeterminate" : (ePromNormal ? "normal" : "abnormal"),
                referencia: "‚â•" + ePromRef + " cm/s"
            });
            // E/A (solo en ritmo sinusal)
            let eaNormal = null;
            if (ritmo === "sinusal" && !isNaN(ea)) {
                if (edad === "1") {
                    eaNormal = ea >= eaMin;
                } else {
                    eaNormal = ea >= eaMin && ea <= eaMax;
                }
                parametros.push({
                    nombre: "Relaci√≥n E/A",
                    valor: ea.toFixed(2),
                    estado: eaNormal ? "normal" : "abnormal",
                    referencia: (edad === "1" ? "‚â•" + eaMin : eaMin + "‚Äì" + eaMax)
                });
            } else if (ritmo === "sinusal") {
                parametros.push({
                    nombre: "Relaci√≥n E/A",
                    valor: "‚Äî",
                    estado: "indeterminate",
                    referencia: (edad === "1" ? "‚â•" + eaMin : eaMin + "‚Äì" + eaMax)
                });
            }
            // LAVI o √Årea AI
            let aiNormal = null, aiValor = null, aiReferencia = "";
            if (tipoAI === "volumen" && !isNaN(volumenAI)) {
                aiNormal = volumenAI <= 34;
                aiValor = volumenAI + " ml/m¬≤";
                aiReferencia = "‚â§34 ml/m¬≤";
            } else if (tipoAI === "area" && !isNaN(areaAI)) {
                aiNormal = areaAI <= 20;
                aiValor = areaAI + " cm¬≤";
                aiReferencia = "‚â§20 cm¬≤";
            } else {
                aiNormal = null;
                aiValor = "‚Äî";
                aiReferencia = tipoAI === "volumen" ? "‚â§34 ml/m¬≤" : "‚â§20 cm¬≤";
            }
            parametros.push({
                nombre: tipoAI === "volumen" ? "Volumen AI indexado" : "√Årea AI",
                valor: aiValor,
                estado: aiNormal === null ? "indeterminate" : (aiNormal ? "normal" : "abnormal"),
                referencia: aiReferencia
            });
            // Velocidad TR
            let trNormal = !isNaN(velocidadRT) && velocidadRT <= 2.8;
            parametros.push({
                nombre: "Velocidad TR",
                valor: isNaN(velocidadRT) ? "‚Äî" : velocidadRT.toFixed(2) + " m/s",
                estado: isNaN(velocidadRT) ? "indeterminate" : (trNormal ? "normal" : "abnormal"),
                referencia: "‚â§2.8 m/s"
            });
            // LA Strain (solo si est√°)
            let laStrainNormal = !isNaN(laStrain) && laStrain >= 23;
            if (!isNaN(laStrain)) {
                parametros.push({
                    nombre: "LA Strain",
                    valor: laStrain.toFixed(1) + " %",
                    estado: laStrainNormal ? "normal" : "abnormal",
                    referencia: "‚â•23%"
                });
            }
            // Mostrar advertencia si falta TR
            showTrWarning(isNaN(velocidadRT));
            // Diagn√≥stico
            let diagnostico = "";
            let pressureStatus = "";
            let recomendaciones = "";
            let feviWarning = document.getElementById('feviWarning');
            let trWarningResult = document.getElementById('trWarningResult');
            let indeterminateNote = document.getElementById('indeterminateNote');
            feviWarning.style.display = "none";
            trWarningResult.style.display = isNaN(velocidadRT) ? "block" : "none";
            indeterminateNote.style.display = "none";
            // Si FEVI <50%
            if (fevi === "menor") {
                diagnostico = "Disfunci√≥n diast√≥lica (FEVI reducida)";
                pressureStatus = evaluarPresionLlenado(parametros, laStrainNormal);
                recomendaciones = "En FEVI reducida, la funci√≥n diast√≥lica se asume alterada. El foco debe estar en estimar la presi√≥n de llenado.";
                feviWarning.style.display = "block";
            } else if (ritmo === "fa") {
                // Algoritmo espec√≠fico para FA
                let alterados = 0, normales = 0;
                // Solo e' promedio, AI y TR y LA Strain
                if (!isNaN(eProm)) alterados += ePromNormal ? 0 : 1, normales += ePromNormal ? 1 : 0;
                if (aiNormal !== null) alterados += aiNormal ? 0 : 1, normales += aiNormal ? 1 : 0;
                if (!isNaN(velocidadRT)) alterados += trNormal ? 0 : 1, normales += trNormal ? 1 : 0;
                if (!isNaN(laStrain)) alterados += laStrainNormal ? 0 : 1, normales += laStrainNormal ? 1 : 0;
                if (alterados >= 2) {
                    diagnostico = "Disfunci√≥n diast√≥lica";
                    pressureStatus = "Presi√≥n de llenado elevada";
                } else if (normales >= 2) {
                    diagnostico = "Funci√≥n diast√≥lica normal";
                    pressureStatus = "Presi√≥n de llenado normal";
                } else {
                    diagnostico = "Indeterminado";
                    pressureStatus = "";
                    indeterminateNote.style.display = "block";
                }
                recomendaciones = "En FA no se grad√∫a la disfunci√≥n diast√≥lica. Se estima presi√≥n de llenado.";
            } else {
                // Algoritmo ASE 2025 para FEVI ‚â•50% y ritmo sinusal
                let alterados = 0, normales = 0, indeterminados = 0;
                // Considerar e' promedio, AI, TR, E/A, LA Strain
                if (!isNaN(eProm)) alterados += ePromNormal ? 0 : 1, normales += ePromNormal ? 1 : 0;
                if (aiNormal !== null) alterados += aiNormal ? 0 : 1, normales += aiNormal ? 1 : 0;
                if (!isNaN(velocidadRT)) alterados += trNormal ? 0 : 1, normales += trNormal ? 1 : 0;
                if (!isNaN(ea)) alterados += eaNormal ? 0 : 1, normales += eaNormal ? 1 : 0;
                if (!isNaN(laStrain)) alterados += laStrainNormal ? 0 : 1, normales += laStrainNormal ? 1 : 0;
                let total = 0;
                if (!isNaN(eProm)) total++;
                if (aiNormal !== null) total++;
                if (!isNaN(velocidadRT)) total++;
                if (!isNaN(ea)) total++;
                if (!isNaN(laStrain)) total++;
                // Diagn√≥stico
                if (total < 3) {
                    diagnostico = "Indeterminado";
                    indeterminateNote.style.display = "block";
                } else if (alterados >= 3) {
                    diagnostico = "Disfunci√≥n diast√≥lica";
                    pressureStatus = "Presi√≥n de llenado elevada";
                } else if (normales >= 3) {
                    diagnostico = "Funci√≥n diast√≥lica normal";
                    pressureStatus = "Presi√≥n de llenado normal";
                } else {
                    diagnostico = "Indeterminado";
                    indeterminateNote.style.display = "block";
                }
                // Grado de disfunci√≥n si corresponde
                if (diagnostico === "Disfunci√≥n diast√≥lica" && !isNaN(ea) && !isNaN(velocidadE)) {
                    if (ea < 0.8 && velocidadE < 50) {
                        diagnostico += " - Grado I (alteraci√≥n de relajaci√≥n)";
                    } else if (ea >= 2.0) {
                        diagnostico += " - Grado III (restrictivo)";
                    } else {
                        diagnostico += " - Grado II (pseudonormal)";
                    }
                }
                recomendaciones = "";
            }
            // Mostrar resultados
            const results = document.getElementById('results');
            results.className = "results";
            if (diagnostico.includes("normal")) results.classList.add("normal");
            else if (diagnostico.includes("Disfunci√≥n") || diagnostico.includes("elevada")) results.classList.add("abnormal");
            else results.classList.add("indeterminate");
            document.getElementById('diagnostico').innerHTML = diagnostico;
            document.getElementById('pressureStatus').innerHTML = pressureStatus;
            // Par√°metros
            let htmlParametros = "";
            parametros.forEach(p => {
                // No mostrar LA Strain si no est√°
                if (p.nombre === "LA Strain" && p.valor === "‚Äî") return;
                htmlParametros += `<div class="parameter-item ${p.estado}"><strong>${p.nombre}:</strong> ${p.valor} <span style="color:#888;font-size:0.95em;">(${p.referencia})</span></div>`;
            });
            document.getElementById('parametros-status').innerHTML = htmlParametros;
            document.getElementById('recomendaciones').innerHTML = recomendaciones;
            results.style.display = "block";
            results.scrollIntoView({behavior: "smooth"});
        }
        // Para presi√≥n de llenado en FEVI reducida
        function evaluarPresionLlenado(parametros, laStrainNormal) {
            let alterados = 0, normales = 0;
            // e' lateral, e' septal, e' promedio, AI, TR, LA Strain
            if (parametros[2].estado !== "indeterminate") alterados += parametros[2].estado === "abnormal" ? 1 : 0, normales += parametros[2].estado === "normal" ? 1 : 0;
            if (parametros[3].estado !== "indeterminate") alterados += parametros[3].estado === "abnormal" ? 1 : 0, normales += parametros[3].estado === "normal" ? 1 : 0;
            if (parametros[4].estado !== "indeterminate") alterados += parametros[4].estado === "abnormal" ? 1 : 0, normales += parametros[4].estado === "normal" ? 1 : 0;
            if (parametros[5] && parametros[5].estado !== "indeterminate") alterados += parametros[5].estado === "abnormal" ? 1 : 0, normales += parametros[5].estado === "normal" ? 1 : 0;
            if (alterados >= 2) return "Presi√≥n de llenado elevada";
            if (normales >= 2) return "Presi√≥n de llenado normal";
            return "";
        }
    </script>
</body>
</html>
